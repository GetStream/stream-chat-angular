<div
  #container
  data-testid="channel-list-container"
  class="str-chat str-chat-angular__channel-list str-chat__channel-list str-chat-channel-list messaging str-chat__theme-{{
    theme$ | async
  }}"
>
  @if ((isError$ | async) === false && (isInitializing$ | async) === false) {
    <div class="str-chat__channel-list-messenger">
      <div class="str-chat__channel-list-messenger__main">
        <ng-content select="[channel-list-top]" />
        @if (!(channels$ | async)?.length) {
          <div class="str-chat__channel-list-empty">
            <stream-icon icon="chat-bubble" />
            <p data-testid="empty-channel-list-indicator">
              {{ "streamChat.You have no channels currently" | translate }}
            </p>
          </div>
        }
        <stream-paginated-list
          [items]="(channels$ | async) ?? []"
          [hasMore]="(hasMoreChannels$ | async) ?? false"
          [isLoading]="isLoadingMoreChannels"
          (loadMore)="loadMoreChannels()"
          [trackBy]="trackByChannelId"
        >
          <ng-template let-channel="item">
            <ng-template #defaultTemplate let-channelInput="channel">
              <stream-channel-preview
                data-testclass="channel-preview"
                [channel]="channelInput"
              />
            </ng-template>
            <div>
              <ng-container
                *ngTemplateOutlet="
                  customChannelPreviewTemplate || defaultTemplate;
                  context: { channel: channel }
                "
              />
            </div>
          </ng-template>
        </stream-paginated-list>
        <ng-content select="[channel-list-bottom]" />
      </div>
    </div>
  } @else {
    @if (isError$ | async) {
      <div
        data-testid="chatdown-container"
        class="str-chat__dow str-chat__channel-list-empty"
      >
        <button (click)="recoverState()" class="str-chat__cta-button">
          {{ "streamChat.Reload channels" | translate }}
        </button>
      </div>
    }
    @if (isInitializing$ | async) {
      <ng-container *ngTemplateOutlet="loadingChannels" />
    }
  }
</div>

<ng-template #loadingChannels>
  <div
    data-testid="loading-indicator-full-size"
    class="str-chat__loading-channels"
  >
    <ng-container *ngTemplateOutlet="loadingChannel" />
    <ng-container *ngTemplateOutlet="loadingChannel" />
    <ng-container *ngTemplateOutlet="loadingChannel" />
  </div>
</ng-template>

<ng-template #loadingChannel>
  <div
    class="str-chat__loading-channels-item str-chat__channel-preview-loading"
  >
    <div class="str-chat__loading-channels-avatar"></div>
    <div
      class="str-chat__loading-channels-meta str-chat__channel-preview-end-loading"
    >
      <div class="str-chat__loading-channels-username"></div>
      <div class="str-chat__loading-channels-status"></div>
    </div>
  </div>
</ng-template>
